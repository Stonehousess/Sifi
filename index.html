<!DOCTYPE html>

<html><head><title>Random Movie Picker</title><style>
body {
    background-color: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}
#movie-poster {
    max-width: 300px;
    margin: 20px auto;
    cursor: pointer;
}
.floating-buttons {
    opacity: 0.5;
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 1000;
}
.floating-buttons button {
    width: 120px;
    height: 40px;
    background-color: #222;
    color: #ffcc00;
    border: 1px solid #ffcc00;
    border-radius: 5px;
    cursor: pointer;
}
.floating-buttons button:hover {
    background-color: #444;
}

#loading-spinner {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #111;
    color: #ffcc00;
    padding: 20px 40px;
    font-size: 20px;
    border: 2px solid #ffcc00;
    border-radius: 10px;
    z-index: 2000;
    display: none;
}
</style></head><body><div id="loading-spinner">Loading...</div>
<h1 id="movie-title">Loading...</h1>
<img alt="Movie Poster" id="movie-poster" src=""/>
<p id="rating"></p><p id="movie-description"></p>
<div class="floating-buttons">
<button id="save-button">Poster</button>
<button id="trailer-button">Trailer</button>
<button id="tmdb-button">TMDB</button>
<button id="next-button">Next</button>
<button id="genre-button">Genre</button>
</div>
<script>
let genres = ['53', '878', '12', '35', '99', '16', '10749', '80'];
let currentGenre = '16';
let currentPosterPath = '';
let currentMovieId = '';

async function getRandomMovie() {
    document.getElementById('loading-spinner').style.display = 'block';

    const genre = currentGenre;
    const randomPage = Math.floor(Math.random() * 20) + 1;  // LIMIT PAGE RANGE
    const apiKey = '0df61cb2a68c352f4171cf60b79327cf';
    const url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&language=en-US&with_genres=${genre}&page=${randomPage}`;

    console.log("Fetching from:", url);

    try {
        const response = await fetch(url);
        const data = await response.json();
        const movies = (data.results || []).filter(movie => movie.poster_path);

        if (!movies.length) {
            console.warn("No movies found for this genre/page.");
            document.getElementById('loading-spinner').style.display = 'none';
            return;
        }

        const randomMovie = movies[Math.floor(Math.random() * movies.length)];
        const title = randomMovie.title;
        const posterPath = randomMovie.poster_path;
        const id = randomMovie.id;
        const year = (randomMovie.release_date || '').slice(0, 4);
        const rating = randomMovie.vote_average.toFixed(1);
        const description = randomMovie.overview || 'No description available.';

        currentPosterPath = 'https://image.tmdb.org/t/p/w500' + posterPath;
        currentMovieId = id;

        document.getElementById('movie-title').innerText = title + ' (' + year + ')';
        document.getElementById('movie-poster').src = currentPosterPath;
        document.getElementById('movie-poster').alt = title;
        document.getElementById('rating').innerText = 'IMDb Rating: ' + rating;
        document.getElementById('movie-description').innerText = description;

        document.getElementById('loading-spinner').style.display = 'none';
    } catch (err) {
        console.error("Movie fetch failed:", err);
        document.getElementById('loading-spinner').style.display = 'none';
    }
}

window.onload = () => {
    getRandomMovie();

    document.getElementById('movie-poster').onclick = getRandomMovie;
    document.getElementById('next-button').onclick = getRandomMovie;

    document.getElementById('genre-button').onclick = () => {
        currentGenre = genres[Math.floor(Math.random() * genres.length)];
        getRandomMovie(); // Also fetch a new movie immediately
    };

    document.getElementById('save-button').onclick = () => {
        if (!currentPosterPath) return;
        const link = document.createElement('a');
        link.href = currentPosterPath;
        link.download = 'poster.jpg';
        link.click();
    };

    document.getElementById('tmdb-button').onclick = () => {
        if (!currentMovieId) return;
        window.open(`https://www.themoviedb.org/movie/${currentMovieId}`, '_blank');
    };
};
</script></body></html>