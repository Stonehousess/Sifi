<!DOCTYPE html>

<html><head><title>Random Movie TV Viewer</title><style>
body {
    background-color: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 0;
    margin: 0;
}
#movie-poster {
    border-radius: 8px;
    transition: transform 0.3s ease;
    height: 100vh;
    object-fit: cover;
    display: block;
    margin: 0 auto;
}
#movie-title {
    font-size: 28px;
    margin-top: 12px;
}
#info-line {
    font-size: 18px;
    margin: 6px 0;
}
#movie-description {
    max-width: 800px;
    margin: 10px auto;
    padding: 10px;
    font-size: 16px;
    line-height: 1.5;
}
.floating-buttons {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 1000;
    opacity: 0.5;
}
.floating-buttons button {
    width: 120px;
    height: 40px;
    background-color: #222;
    color: #ffcc00;
    border: 1px solid #ffcc00;
    border-radius: 5px;
    cursor: pointer;
}
.floating-buttons button:hover {
    background-color: #444;
}
#loading-spinner {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #111;
    color: #ffcc00;
    padding: 20px 40px;
    font-size: 20px;
    border: 2px solid #ffcc00;
    border-radius: 10px;
    z-index: 2000;
    display: none;
}


#movie-poster:hover {
    transform: scale(1.02);
}</style></head><body>
<div id="loading-spinner">Loading...</div>
<img alt="Movie Poster" id="movie-poster" src=""/>
<h1 id="movie-title">Loading...</h1>
<p id="info-line"></p>
<p id="current-genre">Genre: </p><p id="movie-description"></p>
<div class="floating-buttons">
<button id="save-button">Poster</button>
<button id="trailer-button">Trailer</button>
<button id="tmdb-button">TMDB</button>
<button id="next-button">Next</button>
<button id="genre-button">Genre</button>
</div>
<script>let retryCount = 0;
const MAX_RETRIES = 3;

const API_KEY = 'e8d804d1f104509d3c1c5b1166485ae6';


const genres = [
    { name: 'Sci-Fi', movieId: '878', tvId: '10765' },
    { name: 'Adventure', movieId: '12', tvId: '10759' },
    { name: 'Comedy', movieId: '35', tvId: '35' },
    { name: 'Documentary', movieId: '99', tvId: '99' },
    { name: 'Animation', movieId: '16', tvId: '16' },
    { name: 'Romance', movieId: '10749', tvId: '18' },
    { name: 'Crime', movieId: '80', tvId: '80' },
    { name: 'Mystery', movieId: '9648', tvId: '9648' }
];
let currentGenre = genres.find(g => g.name === 'Animation');


let currentPosterPath = '';
let currentType = 'movie';
let currentMovieId = '';
let isMovie = true;
let triedTV = false;
let isFetching = false;

async function getRandomTitle() {
    if (isFetching) return;
    isFetching = true;
    document.getElementById('loading-spinner').style.display = 'block';    const lockedGenre = currentGenre;
    const genreId = isMovie ? lockedGenre.movieId : lockedGenre.tvId;
    const endpoint = isMovie ? 'movie' : 'tv';
    const lockedEndpoint = endpoint;
    if (isFetching) return;
    isFetching = true;
    document.getElementById('loading-spinner').style.display = 'block';        if (!genreId) {
            console.warn("Missing genreId for", endpoint, currentGenre);
            currentGenre = genres[Math.floor(Math.random() * genres.length)];
            document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
            isFetching = false;
            setTimeout(getRandomTitle, 100);
            return;
        }    if (!genreId) {
        console.warn('Missing genreId for', isMovie ? 'Movie' : 'TV', currentGenre);
        isFetching = false;
        return;
    }

    const url = `https://api.themoviedb.org/3/discover/${endpoint}?api_key=${API_KEY}&language=en-US&sort_by=popularity.desc&with_genres=${genreId}&page=${randomPage}`;
    console.log('Fetching:', url);

    try {
        const response = await fetch(url);
        const data = await response.json();
        const results = (data.results || []).filter(r => r.poster_path);

        
        if (!results.length && !isMovie) {
            console.warn("No TV results, trying movie fallback.");
            isMovie = true;
            getRandomTitle(); return;
        }

        if (!results.length) throw new Error("No results");

        const item = results[Math.floor(Math.random() * results.length)];
        const title = item.title || item.name;
        const posterPath = item.poster_path;
        const id = item.id;
        const year = (item.release_date || item.first_air_date || '').slice(0, 4);
        const rating = item.vote_average.toFixed(1);
        const runtime = item.runtime || (item.episode_run_time ? item.episode_run_time[0] : '—');
        const description = item.overview || 'No description available.';

        
        currentPosterPath = 'https://image.tmdb.org/t/p/w500' + posterPath;
        currentMovieId = id;
        currentType = isMovie ? 'movie' : 'tv';
        isMovie = !isMovie;

        
        const emoji = isMovie ? "🎬" : "📺";

        document.getElementById('movie-title').innerText = title + ' (' + year + ')';
        document.getElementById('movie-poster').src = currentPosterPath;
        document.getElementById('info-line').innerText = `${emoji} IMDb Rating: ${rating} | Runtime: ${runtime} min`;
        document.getElementById('movie-description').innerText = description;

                document.getElementById('loading-spinner').style.display = 'none';
                isFetching = false;
        isFetching = false;
    } catch (err) {
        console.error("Fetch failed:", err);
        isFetching = false;
        document.getElementById('loading-spinner').style.display = 'none';
                isFetching = false;
        isFetching = false;
    }

    }

window.onload = () => {
    currentGenre = genres.find(g => g.name === 'Animation');
    document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
    getRandomTitle();

    document.getElementById('movie-poster').onclick = getRandomTitle;
    document.getElementById('next-button').onclick = getRandomTitle;

    document.getElementById('genre-button').onclick = () => {
        currentGenre = genres[Math.floor(Math.random() * genres.length)];
        isMovie = true;
        triedTV = false;
        document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
        document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
        document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
    getRandomTitle();
    };

    
document.getElementById('save-button').onclick = () => {
    const posterUrl = document.getElementById('movie-poster').src;
    fetch(posterUrl)
        .then(response => response.blob())
        .then(blob => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'movie-poster.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });
};

    document.getElementById('tmdb-button').onclick = () => {
        if (!currentMovieId) return;
        const base = isMovie ? 'movie' : 'tv';
        window.open(`https://www.themoviedb.org/${base}/${currentMovieId}`, '_blank');
    };

    document.getElementById('trailer-button').onclick = () => {
        const title = document.getElementById('movie-title').innerText.split(' (')[0];
        window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(title)} trailer`, '_blank');
    };
    };


setInterval(getRandomTitle, 60000);

async function getRandomTitle() {
    if (isFetching) return;
    isFetching = true;
    document.getElementById('loading-spinner').style.display = 'block';    const lockedGenre = currentGenre;
    const genreId = isMovie ? lockedGenre.movieId : lockedGenre.tvId;
    const endpoint = isMovie ? 'movie' : 'tv';
    const lockedEndpoint = endpoint;
    if (isFetching) return;
    isFetching = true;
    document.getElementById('loading-spinner').style.display = 'block';

    try {
        const API_KEY = 'e8d804d1f104509d3c1c5b1166485ae6';        if (!genreId) {
            console.warn("Missing genreId for", endpoint, currentGenre);
            currentGenre = genres[Math.floor(Math.random() * genres.length)];
            document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
            isFetching = false;
            setTimeout(getRandomTitle, 100);
            return;
        }
        if (!genreId) {
            console.warn("Missing genreId for", endpoint, currentGenre);
            isFetching = false;
            return;
        }

        const url = `https://api.themoviedb.org/3/discover/${endpoint}?api_key=${API_KEY}&language=en-US&sort_by=popularity.desc&with_genres=${genreId}&page=${randomPage}`;
        console.log("Fetching:", url);

        const response = await fetch(url);
        const data = await response.json();
        const results = data.results || [];

        const valid = results.filter(item => item.poster_path && (item.title || item.name));
        
        
        
        if (!valid.length) {
            retryCount++;
            if (retryCount >= MAX_RETRIES) {
                console.warn("Max retries reached. No valid results.");
                document.getElementById('loading-spinner').style.display = 'none';
                isFetching = false;
                return;
            }
            console.warn("No valid results for", lockedEndpoint, genreId, "- retry", retryCount);
            document.getElementById('loading-spinner').style.display = 'none';
            isFetching = false;
            setTimeout(getRandomTitle, 500);
            return;
        }
    
            console.warn("No valid results for", endpoint, genreId, "- retry", retryCount);
            document.getElementById('loading-spinner').style.display = 'none';
            currentGenre = genres[Math.floor(Math.random() * genres.length)];
            document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;
            isFetching = false;
            setTimeout(getRandomTitle, 500);
            return;
        }
    

        const item = valid[Math.floor(Math.random() * valid.length)];
        const title = item.title || item.name;
        const year = (item.release_date || item.first_air_date || '').split('-')[0];
        const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
        const runtime = '—';
        const description = item.overview || 'No description available.';
        const posterPath = item.poster_path;
        const id = item.id;

        document.getElementById('movie-poster').src = 'https://image.tmdb.org/t/p/w500' + posterPath;
        document.getElementById('movie-title').innerText = `${title} (${year})`;
        document.getElementById('movie-rating').innerText = `⭐ ${rating} • ⏱️ ${runtime}`;
        document.getElementById('movie-description').innerText = description;
        document.getElementById('current-genre').innerText = 'Genre: ' + currentGenre.name;

        currentPosterPath = 'https://image.tmdb.org/t/p/w500' + posterPath;
        currentMovieId = id;
        currentType = isMovie ? 'movie' : 'tv';
        retryCount = 0;
        retryCount = 0;

    } catch (err) {
        console.error("Fetch failed:", err);
    }

    document.getElementById('loading-spinner').style.display = 'none';
    isFetching = false;
    isMovie = !isMovie;
}
</script><div id="movie-rating"></div></body></html>